# ğŸ¨ Visual Diagrams - SaaS UMKM

## 1. ğŸ”„ User Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Browser                              â”‚
â”‚                     (Next.js Register Page)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 1. POST /api/register
                             â”‚ {name, email, password,
                             â”‚  corporate_name, company_name,
                             â”‚  business_unit_name}
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Laravel Backend                               â”‚
â”‚                  (AuthController::register)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 2. Create Corporate (Level 0)
                             â”‚    tenant_id = self.id
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PostgreSQL   â”‚
                    â”‚                â”‚
                    â”‚  groups table  â”‚
                    â”‚  id = 1        â”‚
                    â”‚  type = corp   â”‚
                    â”‚  level = 0     â”‚
                    â”‚  tenant_id = 1 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 3. Create Company (Level 1)
                             â”‚    parent_id = 1
                             â”‚    tenant_id = 1
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  groups table  â”‚
                    â”‚  id = 2        â”‚
                    â”‚  type = companyâ”‚
                    â”‚  level = 1     â”‚
                    â”‚  parent_id = 1 â”‚
                    â”‚  tenant_id = 1 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 4. Create Business Unit (Level 2)
                             â”‚    parent_id = 2
                             â”‚    tenant_id = 1
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  groups table  â”‚
                    â”‚  id = 3        â”‚
                    â”‚  type = BU     â”‚
                    â”‚  level = 2     â”‚
                    â”‚  parent_id = 2 â”‚
                    â”‚  tenant_id = 1 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 5. Create User
                             â”‚    tenant_id = 1
                             â”‚    is_super_admin = true
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  users table   â”‚
                    â”‚  id = 1        â”‚
                    â”‚  email = ...   â”‚
                    â”‚  tenant_id = 1 â”‚
                    â”‚  is_super = 1  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 6. Attach User to BU
                             â”‚    with is_primary = true
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ group_user tbl â”‚
                    â”‚  group_id = 3  â”‚
                    â”‚  user_id = 1   â”‚
                    â”‚  is_primary=1  â”‚
                    â”‚  role_ids = [] â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 7. Generate Token
                             â”‚    via Laravel Sanctum
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Response to Frontend                          â”‚
â”‚  {                                                               â”‚
â”‚    "message": "Registration successful",                         â”‚
â”‚    "user": {...},                                                â”‚
â”‚    "corporate": {...},                                           â”‚
â”‚    "company": {...},                                             â”‚
â”‚    "business_unit": {...},                                       â”‚
â”‚    "token": "1|xxxxxxxxxxxx"                                     â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 8. Store token in localStorage
                             â”‚    Set auth state in Zustand
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Redirect to Dashboard                        â”‚
â”‚                    User is now logged in!                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ” Permission Check Flow

```
User Action: "Delete Product"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend Component           â”‚
â”‚   Check: hasPermission()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth Store (Zustand)         â”‚
â”‚   permissions: [               â”‚
â”‚     'inventory.delete_product',â”‚
â”‚     'inventory.read_product',  â”‚
â”‚     ...                        â”‚
â”‚   ]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Check if permission exists
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Is Super    â”‚
         â”‚   Admin?     â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚
       Yes              No
        â”‚                â”‚
        â”‚                â–¼
        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚ Has Permission â”‚
        â”‚       â”‚ in array?      â”‚
        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚        Yes            No
        â”‚         â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”‚
                         â”‚       â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                    â”‚   Action Result  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ Yes: Show button â”‚
                    â”‚ No:  Hide button â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Backend API Request Flow:
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Middleware: Authenticate     â”‚
â”‚   Check Bearer Token           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller                   â”‚
â”‚   Get $user from request       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Model                   â”‚
â”‚   hasPermission(               â”‚
â”‚     'inventory.delete_product' â”‚
â”‚   )                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Query Database:              â”‚
â”‚   1. Get user's roles          â”‚
â”‚   2. Get roles' permissions    â”‚
â”‚   3. Check if slug exists      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        Yes              No
         â”‚                â”‚
         â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Allow   â”‚      â”‚  403    â”‚
   â”‚ Action  â”‚      â”‚ Denied  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ¢ Organization Hierarchy Example

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PT Maju Jaya Indonesia    â”‚
                    â”‚   (Corporate - Level 0)     â”‚
                    â”‚   tenant_id = 1             â”‚
                    â”‚   Code: CORP-ABC123         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚                  â”‚
                â–¼                  â–¼                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Cabang Jakartaâ”‚  â”‚ Cabang Bandungâ”‚  â”‚ Cabang Surabayaâ”‚
        â”‚ (Company - L1)â”‚  â”‚ (Company - L1)â”‚  â”‚ (Company - L1)â”‚
        â”‚ parent_id = 1 â”‚  â”‚ parent_id = 1 â”‚  â”‚ parent_id = 1 â”‚
        â”‚ COMP-JKT001   â”‚  â”‚ COMP-BDG001   â”‚  â”‚ COMP-SBY001   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                  â”‚                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚       â”‚  â”‚       â”‚       â”‚  â”‚       â”‚       â”‚
        â–¼       â–¼       â–¼  â–¼       â–¼       â–¼  â–¼       â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”
    â”‚Toko â”‚ â”‚Toko â”‚ â”‚Gudangâ”‚â”‚Toko â”‚â”‚Toko â”‚â”‚Gudangâ”‚â”‚Toko â”‚â”‚Toko â”‚â”‚Gudangâ”‚
    â”‚  A  â”‚ â”‚  B  â”‚ â”‚ JKT  â”‚â”‚  A  â”‚ â”‚  B  â”‚ â”‚ BDG  â”‚â”‚  A  â”‚ â”‚  B  â”‚ â”‚ SBY  â”‚
    â”‚ BU  â”‚ â”‚ BU  â”‚ â”‚  BU  â”‚â”‚ BU  â”‚ â”‚ BU  â”‚ â”‚  BU  â”‚â”‚ BU  â”‚ â”‚ BU  â”‚ â”‚  BU  â”‚
    â”‚ L2  â”‚ â”‚ L2  â”‚ â”‚  L2  â”‚â”‚ L2  â”‚ â”‚ L2  â”‚ â”‚  L2  â”‚â”‚ L2  â”‚ â”‚ L2  â”‚ â”‚  L2  â”‚
    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜

Users & Permissions:

ğŸ‘¤ Super Admin
   â”œâ”€â”€ Access: ALL groups (can see everything)
   â”œâ”€â”€ Groups: Corporate
   â””â”€â”€ Permissions: *.*

ğŸ‘¤ Regional Manager Jakarta
   â”œâ”€â”€ Access: Cabang Jakarta + all its BUs
   â”œâ”€â”€ Groups: Cabang Jakarta (Company)
   â””â”€â”€ Permissions: company.*, inventory.*, pos.*

ğŸ‘¤ Store Manager Toko A Jakarta
   â”œâ”€â”€ Access: Only Toko A
   â”œâ”€â”€ Groups: Toko A (BU)
   â””â”€â”€ Permissions: inventory.*, pos.create_transaction

ğŸ‘¤ Cashier Toko A
   â”œâ”€â”€ Access: Only Toko A
   â”œâ”€â”€ Groups: Toko A (BU)
   â””â”€â”€ Permissions: pos.create_transaction, pos.read_transaction
```

---

## 4. ğŸ’³ Subscription Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Subscription Plans (Global)               â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚   Starter    â”‚  â”‚ Professional â”‚  â”‚  Enterprise  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚  â”‚ Rp 99k/mo    â”‚  â”‚ Rp 299k/mo   â”‚  â”‚ Rp 999k/mo   â”‚
â”‚  â”‚ Max 5 users  â”‚  â”‚ Max 20 users â”‚  â”‚ Unlimited    â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚  â”‚ Modules:     â”‚  â”‚ Modules:     â”‚  â”‚ Modules:     â”‚
â”‚  â”‚ - Inventory  â”‚  â”‚ - Inventory  â”‚  â”‚ - Inventory  â”‚
â”‚  â”‚ - POS        â”‚  â”‚ - POS        â”‚  â”‚ - POS        â”‚
â”‚  â”‚              â”‚  â”‚ - Workshop   â”‚  â”‚ - Workshop   â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ - Garment    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Business Unit subscribes to a plan
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Active Subscriptions                  â”‚
â”‚                                                    â”‚
â”‚  Toko A Jakarta                                    â”‚
â”‚  â”œâ”€â”€ Plan: Professional                            â”‚
â”‚  â”œâ”€â”€ Status: Active                                â”‚
â”‚  â”œâ”€â”€ Started: 2024-01-01                           â”‚
â”‚  â”œâ”€â”€ Expires: 2024-02-01                           â”‚
â”‚  â””â”€â”€ Modules Enabled: [Inventory, POS]             â”‚
â”‚                                                    â”‚
â”‚  Toko B Jakarta                                    â”‚
â”‚  â”œâ”€â”€ Plan: Starter                                 â”‚
â”‚  â”œâ”€â”€ Status: Trial                                 â”‚
â”‚  â”œâ”€â”€ Trial Ends: 2024-01-15                        â”‚
â”‚  â””â”€â”€ Modules Enabled: [POS]                        â”‚
â”‚                                                    â”‚
â”‚  Gudang Jakarta                                    â”‚
â”‚  â”œâ”€â”€ Plan: Enterprise                              â”‚
â”‚  â”œâ”€â”€ Status: Active                                â”‚
â”‚  â”œâ”€â”€ Started: 2024-01-01                           â”‚
â”‚  â”œâ”€â”€ Expires: 2025-01-01 (yearly)                  â”‚
â”‚  â””â”€â”€ Modules Enabled: [Inventory, Workshop]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Module Access Check:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User wants to access POS      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check User's Business Unit    â”‚
â”‚  BU: Toko A Jakarta            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Get BU's Subscription         â”‚
â”‚  Plan: Professional            â”‚
â”‚  Status: Active                â”‚
â”‚  Modules: [Inventory, POS]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check if 'pos' in modules     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        Yes              No
         â”‚                â”‚
         â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Allow   â”‚      â”‚   Redirect  â”‚
   â”‚ Access  â”‚      â”‚   to upgradeâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ğŸ”„ API Request Lifecycle

```
1. User clicks "View Products" button
   â”‚
   â–¼
2. Frontend Component
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  import { useQuery } from   â”‚
   â”‚    '@tanstack/react-query'  â”‚
   â”‚                             â”‚
   â”‚  useQuery({                 â”‚
   â”‚    queryKey: ['products'],  â”‚
   â”‚    queryFn: () =>           â”‚
   â”‚      apiClient.inventory    â”‚
   â”‚        .getProducts()       â”‚
   â”‚  })                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
3. API Client (lib/api.ts)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Axios Request              â”‚
   â”‚  GET /api/products          â”‚
   â”‚                             â”‚
   â”‚  Headers:                   â”‚
   â”‚  - Authorization: Bearer... â”‚
   â”‚  - Content-Type: json       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
4. Laravel Middleware Stack
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  CORS Middleware            â”‚
   â”‚  â”œâ”€ Check origin            â”‚
   â”‚  â””â”€ Allow localhost:3000    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Sanctum Auth Middleware    â”‚
   â”‚  â”œâ”€ Validate token          â”‚
   â”‚  â”œâ”€ Get user from token     â”‚
   â”‚  â””â”€ Attach to request       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Tenant Middleware (TODO)   â”‚
   â”‚  â”œâ”€ Get user's tenant_id    â”‚
   â”‚  â””â”€ Set global scope        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
5. Controller
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ProductController::index() â”‚
   â”‚                             â”‚
   â”‚  $user = $request->user();  â”‚
   â”‚  $tenantId = $user->tenant_id;â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
6. Model Query
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Product::query()           â”‚
   â”‚    ->where('tenant_id',     â”‚
   â”‚            $tenantId)       â”‚
   â”‚    ->get();                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
7. PostgreSQL Database
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  SELECT * FROM products     â”‚
   â”‚  WHERE tenant_id = 1        â”‚
   â”‚  AND deleted_at IS NULL     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
8. Response to Client
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  JSON Response              â”‚
   â”‚  {                          â”‚
   â”‚    "data": [                â”‚
   â”‚      {                      â”‚
   â”‚        "id": 1,             â”‚
   â”‚        "name": "Product A", â”‚
   â”‚        "price": 10000,      â”‚
   â”‚        "tenant_id": 1       â”‚
   â”‚      }                      â”‚
   â”‚    ]                        â”‚
   â”‚  }                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
9. React Query Cache
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Store in cache with:       â”‚
   â”‚  - queryKey: ['products']   â”‚
   â”‚  - data: [...]              â”‚
   â”‚  - staleTime: 1 minute      â”‚
   â”‚  - Background refetch       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
10. Component Re-render
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Display products in UI     â”‚
   â”‚  with loading states &      â”‚
   â”‚  error handling             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Groups    â”‚           â”‚    Users     â”‚
â”‚             â”‚           â”‚              â”‚
â”‚ â€¢ id        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ id         â”‚
â”‚ â€¢ name      â”‚  M:N via  â”‚ â€¢ email      â”‚
â”‚ â€¢ type      â”‚ group_userâ”‚ â€¢ tenant_id  â”‚â”€â”€â”
â”‚ â€¢ level     â”‚           â”‚ â€¢ is_super.. â”‚  â”‚
â”‚ â€¢ parent_id â”‚â”€â”€â”        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â€¢ tenant_id â”‚  â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚         â”‚         â”‚
       â”‚ Self    â”‚         â”‚ Belongs to tenant
       â”‚ Ref     â”‚         â”‚
       â”‚         â”‚         â–¼
       â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚    â”‚   Groups    â”‚
       â”‚         â”‚    â”‚ (as tenant) â”‚
       â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Has many children


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Roles    â”‚           â”‚ Permissions  â”‚
â”‚             â”‚           â”‚              â”‚
â”‚ â€¢ id        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ id         â”‚
â”‚ â€¢ name      â”‚  M:N via  â”‚ â€¢ slug       â”‚
â”‚ â€¢ group_id  â”‚ role_perm â”‚ â€¢ module     â”‚
â”‚ â€¢ is_inher..â”‚           â”‚ â€¢ action     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Belongs to
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Groups    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subscription    â”‚       â”‚ SubscriptionPlan â”‚
â”‚                 â”‚       â”‚                  â”‚
â”‚ â€¢ id            â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ id             â”‚
â”‚ â€¢ group_id      â”‚ M:1   â”‚ â€¢ name           â”‚
â”‚ â€¢ plan_id       â”‚       â”‚ â€¢ modules[]      â”‚
â”‚ â€¢ modules_en[]  â”‚       â”‚ â€¢ price          â”‚
â”‚ â€¢ status        â”‚       â”‚ â€¢ max_users      â”‚
â”‚ â€¢ expires_at    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Belongs to (BU only)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Groups    â”‚
â”‚  (Level 2)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**These diagrams should help visualize how the system works!** ğŸ¨
